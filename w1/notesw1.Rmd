---
title: "Introduction to Linear Models"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Linear Models with R Chapter 1

## Diabetes

```{r}
library(faraway)
library(ggplot2)

data(pima, package = 'faraway')
head(pima)
summary(pima)
```
We can see that this data has zeros in inappropriate places.  These are actually erroneous values...

```{r}
head(sort(pima$diastolic), 50)
```
```{r}
pima$diastolic[pima$diastolic == 0] <- NA
pima$glucose[pima$glucose == 0] <- NA
pima$triceps[pima$triceps == 0] <- NA
pima$insulin[pima$insulin == 0] <- NA
pima$bmi[pima$bmi == 0] <- NA
```

Change the boolean to a factor.

```{r}
pima$test <- factor(pima$test)
levels(pima$test) <- c('negative', 'positive')
summary(pima)
```
Some basic exploratory plots:

```{r}
par(mfrow = c(1, 3))
hist(pima$diastolic, xlab = 'Diastolic', main = '')
plot(density(pima$diastolic, na.rm = TRUE), main = '')
plot(sort(pima$diastolic), ylab = 'Sorted')
```


Some basic bivariate plots:

```{r}
par(mfrow = c(1, 2))
plot(diabetes ~ diastolic, pima)
plot(diabetes ~ test, pima)
```

```{r}
ggplot(pima, aes(x = diastolic)) + geom_histogram()
ggplot(pima, aes(x = diastolic)) + geom_density()
ggplot(pima, aes(x = diastolic, y = diabetes)) + geom_point()
```


```{r}
ggplot(pima, aes(x = diastolic, y = diabetes, col = test)) +
  geom_point() +
  theme(legend.position = 'top', legend.direction = 'horizontal')

ggplot(pima,aes(x=diastolic,y=diabetes)) +
  geom_point(size=1) +
  facet_grid(~ test)
```

## Manilius

Mayer describes the motion of the moon (libration) using the Manilius crater:

```{r}
#\[\text{arc} = \beta + \alpha \text{sinang} + \gamma \text{cosang}\]
```

He wished to obtain values for the three unknowns $\alpha , \beta , \text{and} \gamma$. The variables arc, sinang and cosang can be observed using a telescope.

Since there are three unknowns, we need only three distinct observations of the set of three variables to find a unique solution for $\alpha , \beta , \text{and} \gamma$. Embarassingly for Mayer, there were 27 sets of observations available. Astronomical measurements were naturally subject to some variation and so there was no solution that fit all 27 observations.


```{r}
data(manilius, package = 'faraway')
head(manilius)
```

Mayerâ€™s solution was to divide the data into three groups so that observations within each group were similar in some respect. He then computed the sum of the variables within each group. We can also do this:

```{r}
(moon3 <- aggregate(manilius[,1:3], list(manilius$group), sum))
```

3 equations, 3 unknowns... Solved with matrices.

```{r}
solve(cbind(9, moon3$sinang, moon3$cosang), moon3$arc)
```

Suppose it isn't exact, and we add an error term...

```{r}
#\[\text{arc}_i = \beta + \alpha \text{sinang}_i + \gamma \text{cosang}_i + \epsilon_i\]
```

Don't forget that $i = 1, 2, ..., 27$. We can find the $\alpha , \beta , \gamma$ which minimize the sum of the squared errors: $\sum \epsilon^2$.

```{r}
lmod <- lm(arc ~ sinang + cosang, manilius)
coef(lmod)
```

---

## Galton families

```{r}

# \[\text{childHeight} = \alpha + \beta \text{}midparentHeight + \epsilon\]

data(GaltonFamilies, package = 'HistData')
plot(childHeight ~ midparentHeight, GaltonFamilies)

lmod <- lm(childHeight ~ midparentHeight, GaltonFamilies)

coef(lmod)
abline(lmod)
```

\[\frac{y - \bar{y}}{SD_y} = r \frac{x - \bar{x}}{SD_x}\]

$r$ is the correlation between x and y.


```{r}
(beta <- with(GaltonFamilies, 
             cor(midparentHeight, 
                 childHeight) * sd(childHeight) / sd(midparentHeight)))

(alpha <- with(GaltonFamilies,
               mean(childHeight) - beta * mean(midparentHeight)))
```

Set $r = 1$ and we can compute a better line...

```{r}
(beta1 <- with(GaltonFamilies,
               sd(childHeight) / sd(midparentHeight)))

(alpha1 <- with(GaltonFamilies,
                mean(childHeight) - beta1 * mean(midparentHeight)))


plot(childHeight ~ midparentHeight, GaltonFamilies)
abline(lmod)
abline(alpha1, beta1, lty=2)
```


